######################################################################################
# 1. Prefixes
######################################################################################

@prefix rr:       <http://www.w3.org/ns/r2rml#>.
@prefix rml:      <http://semweb.mmlab.be/ns/rml#>.
@prefix crml:     <http://semweb.mmlab.be/ns/crml#> .
@prefix ex:       <http://example.com/ns#>.
@prefix ql:       <http://semweb.mmlab.be/ns/ql#>.
@prefix xsd:      <http://www.w3.org/2001/XMLSchema#>.
@prefix rdfs:     <http://www.w3.org/2000/01/rdf-schema#>.
@prefix dcterms:  <http://purl.org/dc/terms/> .
@prefix sgd:      <http://www.kb.nl/namespaces/handelingen> .
@prefix hydra:    <http://www.w3.org/ns/hydra/core#> .


######################################################################################
# 2. Mapping Document Metadata
######################################################################################

[]  dcterms:title "KB Mappings - SGD register";
    dcterms:description "Describes an RML mapping from the sgd_register.xml input source to RDF " ;
    dcterms:creator <http://rml.io/people/AnastasiaDimou> ;
    dcterms:created "2016-03-18"^^xsd:date;
    dcterms:modified "2016-03-21"^^xsd:date .


######################################################################################
# 3. Input Sources
######################################################################################

<#InputAPI>
    a hydra:IriTemplate ;
    hydra:template "{file}" .

<#SGD_register_LogicalSource>
  rml:source "Input/Sample/sgd_register_sample.xml" ;
  rml:iterator "/data/metadata/srw_dc:dc";
  rml:referenceFormulation ql:XPath .


######################################################################################
# 4. Mapping Definitions
######################################################################################


<#SGD_register_Mapping>
  rml:logicalSource <#SGD_register_LogicalSource> ;

  rr:subjectMap [ 
    rml:reference "dc:identifier" ;
    rr:termType rr:IRI ;
    rr:class ex:Lemma ] ;

  #rr:predicateObjectMap [
  #  rr:predicate sgd:registerUri ;
  #  rr:objectMap [
  #    rml:reference "sgd:registerUri";
  #    rr:termType rr:IRI  ] ];

  rr:predicateObjectMap [
    rr:predicate sgd:registerUri ;
    rr:objectMap [
      rr:parentTriplesMap <#Register_Mapping> ;
      crml:binding [
        rml:reference "sgd:registerUri" ;
        rr:termType rr:IRI;
        crml:variable "file" ] ] ] .


<#Register_Mapping>
  rml:logicalSource [
    rml:source <#InputAPI> ;
    rml:iterator "/*[name()='OAI-PMH']/*[name()='GetRecord']/*[name()='record']/*[name()='header']";
    rml:referenceFormulation ql:XPath ];

  rr:subjectMap [ 
    #rr:termType rr:BlankNode ;
    rr:template "http://data.kb.nl/sgd/document/{//*[name()='identifier']}" ;
    rr:class ex:Register ].