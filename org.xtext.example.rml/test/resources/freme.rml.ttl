@prefix rr:     <http://www.w3.org/ns/r2rml#>.
@prefix rml:    <http://semweb.mmlab.be/ns/rml#> .
@prefix crml:   <http://semweb.mmlab.be/ns/crml#> .
@prefix fnml:   <http://semweb.mmlab.be/ns/fnml#> .
@prefix fno: 	<http://w3id.org/function/ontology#> .
@prefix ql:     <http://semweb.mmlab.be/ns/ql#> .
@prefix dbo:	<http://dbpedia.org/ontology/> .
@prefix dbf:	<http://dbpedia.org/function/> .
@prefix geo: 	<http://www.w3.org/2003/01/geo/wgs84_pos#> .
@prefix georss: <http://www.georss.org/georss/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix xsd:	<http://www.w3.org/2001/XMLSchema#> .
@prefix rdf: 	<http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix ex: 	<http://example.org/> .
@prefix grel: 	<http://users.ugent.be/~bjdmeest/function/grel.ttl#> .
@prefix dd: 	<http://users.ugent.be/~bjdmeest/function/deduplication.ttl#> .
@prefix cordis: <http://www.freme-project.eu/datasets/cordis/> .
@prefix dbc:    <http://dbpedia.org/resource/Category:> .
@prefix doap:   <http://usefulinc.com/ns/doap#> .
@prefix foaf:   <http://xmlns.com/foaf/0.1/> .
@prefix vcard:  <http://www.w3.org/2006/vcard/ns#> .
@prefix dbp:    <http://dbpedia.org/property/> .
@prefix frp:    <http://www.freme-project.eu/ns/>.
@prefix skos:   <http://www.w3.org/2004/02/skos/core#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix dc: <http://purl.org/dc/elements/1.1/>.

<#InstituteMapping>

  rml:logicalSource [
    rml:source "/home/pheyvaer/Developer/MapDoc_FREME/grid/grid2.json" ;
    rml:referenceFormulation ql:JSONPath ;
    rml:iterator "$.institutes"
  ];
  
  #condition on status
  rr:subjectMap [
    rr:template "http://www.freme-project.eu/resource/grid/institutes/{id}"
  ];

  rr:predicateObjectMap [
    rr:predicate rdfs:label;
    rr:objectMap [
      rml:reference "name"
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate foaf:primaryTopic;
    rr:objectMap [
      rml:reference "wikipedia_url";
      rr:termType rr:IRI
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate foaf:mbox;
    rr:objectMap [
      rr:template "mailto:{.email_address}";
 
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate foaf:homepage;
    rr:objectMap [
      rml:reference "links";
      #function required
      rr:termType rr:IRI
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate skos:altLabel;
    rr:objectMap [
      rml:reference "acronyms";

    ]
  ];

  rr:predicateObjectMap [
    rr:predicate skos:altLabel;
    rr:objectMap [
      rml:reference "aliases";
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate dc:subject;
    rr:objectMap [
      rml:reference "types";
      #function required
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate frp:ipaddress;
    rr:objectMap [
      rml:reference "ip_addresses";
      #function required
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate dbo:foundYear;
    rr:objectMap [
      rml:reference "established";
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate frp:relationship;
    rr:objectMap [
      rr:parentTriplesMap <#RelationshipMapping>
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate vcard:hasAddress;
    rr:objectMap [
      rr:parentTriplesMap <#AddressMapping>
    ]
  ].

<#RelationshipMapping>

  rml:logicalSource [
    rml:source "/home/pheyvaer/Developer/MapDoc_FREME/grid/grid2.json" ;
    rml:referenceFormulation ql:JSONPath ;
    rml:iterator "$.institutes.relationships"
  ];
  
  rr:subjectMap [
 
    rr:template "http://www.freme-project.eu/resource/grid/relationships/{type}{label}{id}"
  ];

  rr:predicateObjectMap [
    rr:predicate frp:relationType;
    rr:objectMap [
      rml:reference "type"
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate rdfs:label;
    rr:objectMap [
      rml:reference "label";
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate dc:identifier;
    rr:objectMap [
      rr:parentTriplesMap <#InstituteMapping>;
      rr:joinCondition [
        rr:child "id";
        rr:parent "id"
      ]
    ]
  ].


<#AddressMapping>

  rml:logicalSource [
    rml:source "/home/pheyvaer/Developer/MapDoc_FREME/grid/grid2.json" ;
    rml:referenceFormulation ql:JSONPath ;
    rml:iterator "$.institutes.addresses"
  ];
  
  rr:subjectMap [
    rr:template "http://www.freme-project.eu/resource/grid/addresses/{lat}{lng}"
  ];

  rr:predicateObjectMap [
    rr:predicate vcard:locality;
    rr:objectMap [
      rml:reference "city"
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate vcard:region;
    rr:objectMap [
      rml:reference "state"
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate vcard:country-name;
    rr:objectMap [
      rml:reference "country"
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate dbp:iso31661Alpha;
    rr:objectMap [
      rml:reference "country_code"
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate dbp:provinceIsoCode;
    rr:objectMap [
      rml:reference "state_code"
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate dbp:zipCode;
    rr:objectMap [
      rml:reference "postcode"
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate geo:lat;
    rr:objectMap [
      rml:reference "lat"
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate geo:lng;
    rr:objectMap [
      rml:reference "lng"
    ]
  ];

  rr:predicateObjectMap [
    rr:predicate vcard:locality;
    rr:objectMap [
      rml:reference "geonames_city"
    ]
  ].
